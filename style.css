/* =========================================================
   Slot Frontend — CSS complet (coins alignés + desktop 24")
   - Rayons concentriques (un seul R de référence)
   - Verre flouté parfaitement découpé (Safari & Chrome)
   - Mise à l’échelle fluide via container queries
   - HUD par défaut en bas-gauche (safe-areas), preset .hud-top-right
   ====================/* Labels compacts */
.hud-card.hud-compact .hud-label{
  font-size: 11px;
  letter-spacing: .04em;
  text-transform: uppercase;
  color: var(--hud-label);
  opacity: .9;
  margin-top: 6px;
  text-align: center;
}
.hud-card.hud-compact .hud-label:first-child{ margin-top: 0 }

/* Valeurs bien lisibles (tabular-nums pour l'alignement des chiffres) */
.hud-card.hud-compact .hud-value{
  font-size: 22px;
  font-weight: 800;
  color: var(--hud-text);
  line-height: 1.1;
  font-variant-numeric: tabular-nums;
  margin-bottom: 6px;
  text-align: center;
}

/* ================= */

/* -------- Reset -------- */
*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,sans-serif;
  color:#eef2ff;
  background:var(--bg-gradient,radial-gradient(1200px 800px at 20% 10%,#1c1f3b 0%,#0f1123 45%,#090a16 100%));
  transition:background .26s ease-in-out;
  overflow:hidden;
}

/* -------- Variables globales -------- */
:root{
  /* Taille machine (optimisée 24") */
  --stage-min: 1200px;
  --stage-ideal: 86vw;       /* 86–90 selon goût */
  --stage-max: 1760px;

  /* Cadre "cabinet" */
  --machine-padding: 16px;
  --stroke: 1px;             /* épaisseur de bord du cabinet */
  --R: 28px;                 /* rayon de base — unique source de vérité */
  --cabinet-blur: 10px;
  --cabinet-bg-a1:.015; --cabinet-bg-a2:.008; --cabinet-border-a:.08;
  --glass-reflect:.12;

  /* Déclinaisons de rayon (concentriques) */
  --R-cabinet-inner: calc(max(0px, var(--R) - var(--stroke)));
  --R-reels:         calc(max(0px, var(--R) - var(--machine-padding)));
  --R-reels-glass:   var(--R-reels);   /* le blur suit exactement le rayon reels */

  /* Verre / masques */
  --reels-blur: 22px;
  --reels-tint: .12;
  --mask-top: .10; --mask-bottom:.12;
  --mask-inset-x: 28px; --mask-height: 14%;

  /* Colonnes & icônes */
  --reel-gap: 18px;
  --reel-border-a:.055;
  --symbol-ratio:.78;  /* h symbole = .78 x largeur colonne */
  --icon-scale:.76;    /* occupation interne de l’image */

  /* Accents */
  --accent:#7c9aff; --accent-2:#00f5d4; --success:#30e68f;
  --shadow:0 20px 60px rgba(0,0,0,.55);

  /* Animation des rouleaux */
  --spin-blur: 0px;
  --spin-perspective: 900px;
  --spin-rotation: 0deg;
  --spin-scale: 1;
  --spin-brightness: 1;

  /* HUD (thémable) */
  /* --- variables utiles (à garder dans :root) --- */
  /* marge du HUD (utilisée avec les safe-areas) */
  --hud-offset: clamp(12px, 2vmin, 18px);
  /* couleurs & police injectées par le thème (applyTheme) :
     --hud-bg, --hud-border, --hud-blur, --hud-text, --hud-label, --hud-accent, --hud-font */
  --hud-bg: rgba(12,18,26,.15);
  --hud-border: rgba(255,255,255,.05);
  --hud-blur: 10px;
  --hud-text:#fff; --hud-label:#cfe6ff; --hud-accent:#7c9aff; --hud-font:inherit;

  /* Couleurs pour les messages de défaite */
  --lose-overlay-bg: rgba(0, 0, 0, 0.85);
  --lose-message-bg: rgba(40, 44, 60, 0.65); /* plus transparent */
  --lose-message-border: transparent; /* pas de bordure */
  --lose-text-color: #ff6b6b;
  --lose-hint-color: #a0a0a0;
}

/* Mode immersif */
.immersive{
  --cabinet-bg-a1:.010; --cabinet-bg-a2:.005; --cabinet-border-a:.06;
  --reels-blur:24px; --reels-tint:.10; --reel-border-a:.045;
  --mask-top:.08; --mask-bottom:.10;
  /* HUD plus discret en mode immersif */
  --hud-bg: rgba(12,18,26,.15);
  --hud-border: rgba(255,255,255,.05);
}

/* -------- Layout -------- */
.app{ width:100%; min-height:100dvh; display:grid; place-items:center; padding:clamp(12px,2vmin,32px) }
.stage{
  width:clamp(var(--stage-min),var(--stage-ideal),var(--stage-max));
  display:grid; gap:clamp(16px,2vmin,28px);
  align-items:center; justify-items:center; margin:0 auto;
}

/* -------- État par défaut au chargement : UI masquée -------- */
body.ui-hidden .holds{ display:none !important }
body.ui-hidden #spinBtn{ display:none !important }
body.ui-hidden .bet-controls .btn{ display:none !important }
body.ui-hidden .bet-controls{
  justify-content: center;
  gap: 0;
}
body.ui-hidden .hud-card.hud-compact .bet-controls{
  display: grid;
  grid-template-columns: 1fr;
}
body.ui-hidden .hud-card.hud-compact .bet-controls .hud-value{
  text-align: center;
}
body.ui-hidden .hud-card.hud-compact{
  width: clamp(100px, 15vmin, 130px) !important;
  padding: 6px 8px 8px;
}
body.ui-hidden .hud-card:not(.hud-compact){
  min-width: 140px !important;
  max-width: 180px !important;
  padding: 6px 8px 8px;
}
body.ui-hidden .hud-card .hud-grid{
  gap: 4px 0;
}

/* -------- HUD flottant (bas‑gauche + safe-areas) -------- */
.hud-floating{
  position: fixed;
  left:  calc(var(--hud-offset) + env(safe-area-inset-left));
  bottom: calc(var(--hud-offset) + env(safe-area-inset-bottom));
  right: auto; top: auto;
  z-index: 30;
  font-family: var(--hud-font, inherit); /* police du thème */
}

/* Carte & contenus : pilotés par le thème via --hud-* */
.hud-card{
  min-width:220px; max-width:320px;
  background:var(--hud-bg);
  border:1px solid var(--hud-border);
  border-radius:14px; padding:10px 12px;
  backdrop-filter:blur(var(--hud-blur)) saturate(115%); 
  -webkit-backdrop-filter:blur(var(--hud-blur)) saturate(115%);
  box-shadow:var(--shadow);
  position: relative; overflow: hidden;
  /* Transition douce quand le HUD change de largeur */
  transition: width .18s ease, min-width .18s ease, max-width .18s ease, padding .18s ease;
}

/* Reflet intérieur du HUD (comme le cabinet) */
.hud-card::before{
  content:""; position:absolute; inset:1px;
  border-radius:calc(14px - 1px);
  background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0) 42%);
  pointer-events:none; mix-blend-mode:soft-light;
  /* anti‑alias Safari pour pseudo-élément + blur */
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  z-index: 0;
}
.hud-grid{ display:grid; grid-template-columns:1fr auto; gap:8px 10px; align-items:center; position: relative; z-index: 1 }
.hud-label{ font-size:12px; color:var(--hud-label); opacity:.95; text-align:center }
.hud-value{ font-size:20px; font-weight:800; color:var(--hud-text); text-align:center }
.bet-controls{ display:flex; gap:6px; align-items:center; position: relative; z-index: 1 }
.btn.hud{ padding:2px 8px; font-size:14px; line-height:1.2 }
.hud-accent{ color: var(--hud-accent); }

/* (optionnel) preset haut‑droite sans toucher le CSS :
   ajoute la classe .hud-top-right à l’élément .hud-floating */
.hud-top-right{
  top:    calc(var(--hud-offset) + env(safe-area-inset-top));
  right:  calc(var(--hud-offset) + env(safe-area-inset-right));
  bottom: auto; left: auto;
}

/* -------- Cabinet (cadre extérieur) -------- */
.machine{
  position:relative; width:100%;
  border:var(--stroke) solid rgba(255,255,255,var(--cabinet-border-a));
  border-radius:var(--R);
  padding:var(--machine-padding);
  background:linear-gradient(180deg,rgba(255,255,255,var(--cabinet-bg-a1)),rgba(255,255,255,var(--cabinet-bg-a2)));
  box-shadow:0 14px 50px rgba(0,0,0,.28);
  overflow:hidden;
  backdrop-filter:blur(var(--cabinet-blur)) saturate(115%);
  -webkit-backdrop-filter:blur(var(--cabinet-blur)) saturate(115%);
}
/* reflet intérieur du cabinet — exactement concentrique */
.machine::before{
  content:""; position:absolute; inset:var(--stroke);
  border-radius:var(--R-cabinet-inner);
  background:linear-gradient(180deg,rgba(255,255,255,var(--glass-reflect)),rgba(255,255,255,0) 42%);
  pointer-events:none; mix-blend-mode:soft-light;
  /* anti‑alias Safari pour pseudo-élément + blur */
  -webkit-mask-image: -webkit-radial-gradient(white, black);
}

/* -------- Zone des 5 rouleaux -------- */
.reels{
  width:100%;
  display:grid; grid-template-columns:repeat(5,1fr); gap:var(--reel-gap);
  padding:0;
  border-radius:var(--R-reels);
  position:relative; overflow:hidden; isolation:isolate;
  container-type:inline-size; /* active 100cqw */
}
/* Couche blur + teinte (parfaitement découpée au même rayon) */
.reels::before{
  content:""; position:absolute; inset:0;
  border-radius:var(--R-reels-glass);
  backdrop-filter:blur(var(--reels-blur)); -webkit-backdrop-filter:blur(var(--reels-blur));
  background:rgba(8,14,22,var(--reels-tint));
  z-index:0;
  /* deux sécurités anti “bavures” de coins (Safari/WebKit) */
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  clip-path: inset(0 round var(--R-reels-glass));
}
/* Masques doux haut/bas — mêmes coins, pas collés aux bords */
.reels::after{
  content:""; position:absolute; inset:0; border-radius:var(--R-reels);
  pointer-events:none; z-index:1;
  background:
    linear-gradient(180deg,rgba(0,0,0,var(--mask-top)),rgba(0,0,0,0) 70%) no-repeat,
    linear-gradient(  0deg,rgba(0,0,0,var(--mask-bottom)),rgba(0,0,0,0) 70%) no-repeat;
  background-size:
    calc(100% - (var(--mask-inset-x)*2)) var(--mask-height),
    calc(100% - (var(--mask-inset-x)*2)) var(--mask-height);
  background-position:
    left var(--mask-inset-x) top,
    left var(--mask-inset-x) bottom;
}

/* -------- Colonnes -------- */
.reel{
  border-radius:16px;
  background:transparent !important;
  border:1px solid rgba(255,255,255,var(--reel-border-a));
  box-shadow:none; position:relative; overflow:hidden; 
  perspective: var(--spin-perspective); 
  z-index:2;
  /* Transition pour les effets visuels */
  transition: 
    transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    filter 0.3s ease,
    box-shadow 0.3s ease;
}

/* États d'animation des rouleaux - améliorés */
.reel.spinning {
  transform: scale(var(--spin-scale));
  filter: 
    brightness(var(--spin-brightness))
    saturate(1.1);
  box-shadow: 
    0 0 15px rgba(124, 154, 255, 0.2),
    inset 0 0 8px rgba(255, 255, 255, 0.08);
}

.reel.spinning .reel-inner {
  transform-style: preserve-3d;
  /* Animation de rotation continue et rapide pour effet de défilement */
  animation: spinRotationFast 0.06s linear infinite;
}

@keyframes spinRotationFast {
  0% { transform: rotateX(0deg) translateZ(0); }
  100% { transform: rotateX(360deg) translateZ(0); }
}

/* Animation de démarrage avec vrai effet de défilement */
.reel.spin-starting .reel-inner {
  animation: spinStartupScroll 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

@keyframes spinStartupScroll {
  0% { 
    transform: translateY(0) rotateX(0deg) scale(1);
    filter: blur(0px);
  }
  20% { 
    transform: translateY(-3px) rotateX(45deg) scale(1.01);
    filter: blur(0.5px);
  }
  60% { 
    transform: translateY(-1px) rotateX(180deg) scale(1.005);
    filter: blur(0.8px);
  }
  100% { 
    transform: translateY(0) rotateX(360deg) scale(1);
    filter: blur(0px);
  }
}

/* Animation d'arrêt avec rebond */
.reel.spin-stopping .reel-inner {
  animation: spinStop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes spinStop {
  0% { 
    transform: translateY(0) scale(1);
    filter: blur(3px) brightness(1.1);
  }
  60% { 
    transform: translateY(8px) scale(0.98);
    filter: blur(1px) brightness(1.05);
  }
  80% { 
    transform: translateY(-3px) scale(1.01);
    filter: blur(0.5px) brightness(1.02);
  }
  95% { 
    transform: translateY(1px) scale(1);
    filter: blur(0px) brightness(1);
  }
  100% { 
    transform: translateY(0) scale(1);
    filter: blur(0px) brightness(1);
  }
}

.reel.held{
  border-color:var(--accent-2);
  box-shadow:0 0 0 2px rgba(0,245,212,.22);
}
.reel.held::before{
  content:"HOLD"; position:absolute; top:6px; left:50%; transform:translateX(-50%);
  font-size:12px; font-weight:800; letter-spacing:.5px; color:#001;
  background:var(--accent-2); padding:2px 8px; border-radius:8px; box-shadow:var(--shadow); z-index:3;
}
.reel-inner{ position:absolute; left:0; right:0; top:0; will-change:transform }

/* -------- Icônes -------- */
@supports (width:1cqw){
  .reels{
    --track: calc((100cqw - (var(--reel-gap)*4)) / 5);           /* largeur d'une colonne */
    --symbol-size: calc(var(--track) * var(--symbol-ratio));     /* hauteur d'un symbole */
  }
}
@supports not (width:1cqw){
  :root{ --reel-width: clamp(170px, 13.5vmin, 260px); --symbol-size: calc(var(--reel-width)*var(--symbol-ratio)); }
  .reels{ grid-template-columns:repeat(5,var(--reel-width)) }
}
/* Hauteur fixe pour exactement 3 symboles visibles */
.reel{ 
  height: calc(var(--symbol-size) * 3); 
  /* S'assurer que les 3 symboles sont parfaitement visibles */
  min-height: calc(var(--symbol-size) * 3);
}

.symbol{
  position:relative; z-index:3; height:var(--symbol-size);
  display:flex; align-items:center; justify-content:center;
  text-shadow:0 8px 16px rgba(0,0,0,.32);
  filter:drop-shadow(0 8px 16px rgba(0,0,0,.30));
  /* Transitions pour les effets visuels */
  transition: 
    transform 0.2s ease,
    filter 0.2s ease,
    opacity 0.2s ease;
  /* S'assurer que les symboles ont exactement la bonne taille */
  min-height: var(--symbol-size);
  max-height: var(--symbol-size);
  box-sizing: border-box;
}

/* Effets visuels pendant le spin */
.reel.spinning .symbol {
  transform: translateZ(0);
  filter: 
    drop-shadow(0 8px 16px rgba(0,0,0,.30))
    blur(0.5px);
}

/* Animation d'apparition des symboles à l'arrêt */
.reel.spin-stopping .symbol {
  animation: symbolReveal 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes symbolReveal {
  0% { 
    transform: scale(0.9) rotateY(5deg);
    opacity: 0.8;
    filter: 
      drop-shadow(0 8px 16px rgba(0,0,0,.30))
      blur(2px) brightness(1.2);
  }
  50% { 
    transform: scale(1.05) rotateY(0deg);
    opacity: 0.95;
    filter: 
      drop-shadow(0 8px 16px rgba(0,0,0,.30))
      blur(0.5px) brightness(1.1);
  }
  100% { 
    transform: scale(1) rotateY(0deg);
    opacity: 1;
    filter: 
      drop-shadow(0 8px 16px rgba(0,0,0,.30))
      blur(0px) brightness(1);
  }
}

.symbol img, .symbol.emoji>span{
  width:calc(var(--icon-scale)*100%); height:calc(var(--icon-scale)*100%);
  object-fit:contain; display:block;
}
/* Surbrillance gain */
.symbol.win-highlight::after{
  content:""; position:absolute; inset:10px;
  border:3px solid var(--success); border-radius:12px;
  box-shadow:0 0 0 3px rgba(48,230,143,.25), 0 10px 28px rgba(48,230,143,.35);
  pointer-events:none;
  animation: winPulse 1.5s ease-in-out infinite alternate;
}

@keyframes winPulse {
  0% { 
    transform: scale(1);
    box-shadow:0 0 0 3px rgba(48,230,143,.25), 0 10px 28px rgba(48,230,143,.35);
  }
  100% { 
    transform: scale(1.05);
    box-shadow:0 0 0 6px rgba(48,230,143,.4), 0 15px 35px rgba(48,230,143,.5);
  }
}

/* Particules de victoire */
.win-particles {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 10;
  overflow: hidden;
}

.particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: var(--success);
  border-radius: 50%;
  animation: particleFloat 2s ease-out forwards;
}

@keyframes particleFloat {
  0% {
    opacity: 1;
    transform: translateY(0) scale(0);
  }
  10% {
    transform: translateY(-10px) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateY(-100px) scale(0.5);
  }
}

.particle:nth-child(2n) {
  background: var(--accent);
  animation-delay: 0.1s;
  animation-duration: 2.2s;
}

.particle:nth-child(3n) {
  background: var(--accent-2);
  animation-delay: 0.2s;
  animation-duration: 1.8s;
}

.particle:nth-child(4n) {
  width: 6px;
  height: 6px;
  animation-delay: 0.15s;
}

/* -------- Ligne de boutons (optionnelle) -------- */
.holds{ display:grid; justify-content:center }
.holds-row{
  display:flex; flex-wrap:nowrap; align-items:center; gap:14px;
  width:100%; max-width:clamp(var(--stage-min),var(--stage-ideal),var(--stage-max));
  padding-top:6px; overflow-x:auto;
}
.hold-btn{ font-size:14px; flex:0 0 auto }
.hold-btn.active{ border-color:var(--accent-2); box-shadow:0 0 0 2px rgba(0,245,212,.25), 0 8px 22px rgba(0,245,212,.30) }
.hold-btn:disabled{ opacity:.5; cursor:not-allowed }
.start-in-row{ margin-left:auto; flex:0 0 auto }

/* -------- Boutons génériques -------- */
.btn{
  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(180deg,rgba(255,255,255,.15),rgba(255,255,255,.05));
  color:#fff; border-radius:10px; padding:10px 14px; cursor:pointer;
  transition:transform 120ms ease, background 120ms ease, box-shadow 120ms ease;
  box-shadow:var(--shadow); font-weight:700;
}
.btn.small{ padding:6px 10px; font-size:16px }
.btn.big{ font-size:18px; padding:12px 18px }
.btn.primary{ border-color:rgba(124,154,255,.55); background:linear-gradient(180deg,rgba(124,154,255,.6),rgba(124,154,255,.25)); box-shadow:0 10px 30px rgba(124,154,255,.4) }
.btn:active{ transform:translateY(1px) scale(.995) }
.btn:hover{ box-shadow:0 14px 36px rgba(124,154,255,.45) }
.glow{ box-shadow:0 0 0 2px rgba(255,255,255,.25), 0 0 24px var(--accent-2); border-color:var(--accent-2) }

/* -------- Dev panel -------- */
.dev-panel{
  position:fixed; right:16px; bottom:16px; z-index:40;
  width:min(420px,95vw); max-height:68vh; overflow:auto;
  background:rgba(0,15,30,.18);
  border:1px solid rgba(255,255,255,.14);
  border-radius:12px; padding:10px 12px;
  backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
  box-shadow:var(--shadow);
  /* Caché par défaut au chargement */
  display: none;
}
.dev-panel.show{ display: block; }
.dev-panel .dev-row{ display:grid; grid-template-columns:auto 1fr; gap:8px; align-items:center; margin-bottom:8px }
.dev-panel .dev-row label{ color:#cfe6ff; font-size:13px }
.dev-panel .dev-msg{ grid-column:1 / -1; font-size:14px; color:#cfe6ff; max-height:160px; overflow:auto }
.hidden{ display:none !important }

/* -------- Mode clavier only (MAJ) -------- */
/* Cache toute la ligne HOLD + START */
.ui-hidden .holds{ display:none !important }

/* (Redondant/sécurisant) : cache aussi le bouton Lancer si isolé */
.ui-hidden #spinBtn{ display:none !important }

/* Cache uniquement les boutons - / + de la Mise, conserve la valeur au centre */
.ui-hidden .bet-controls .btn{ display:none !important }

/* Aligne proprement la valeur de Mise quand les boutons sont masqués */
.ui-hidden .bet-controls{
  justify-content: center; /* pour la version flex par défaut */
  gap: 0;
}

/* Si tu utilises le HUD compact (grid), on force 1 colonne centrée */
.ui-hidden .hud-card.hud-compact .bet-controls{
  display: grid;
  grid-template-columns: 1fr;
}
.ui-hidden .hud-card.hud-compact .bet-controls .hud-value{
  text-align: center;
}

/* Quand on masque la barre HOLD/START (+ les boutons -/+) :
   - Si tu utilises le HUD compact -> encore plus étroit */
.ui-hidden .hud-card.hud-compact{
  width: clamp(100px, 15vmin, 130px) !important;  /* encore plus étroit que 120–150px */
  padding: 6px 8px 8px;
}

/* Réduit la largeur du HUD normal quand UI est masquée (220–320px -> plus compact) */
.ui-hidden .hud-card:not(.hud-compact){
  min-width: 140px !important;
  max-width: 180px !important;
  padding: 6px 8px 8px;
}

/* Resserre un peu l'espacement interne quand les contrôles sont masqués */
.ui-hidden .hud-card .hud-grid{
  gap: 4px 0;
}


/* -------- Responsive -------- */
@media (min-width:2300px){
  :root{ --stage-ideal:78vw; --stage-max:2000px; --symbol-ratio:.80; --icon-scale:.78 }
}
@media (max-width:1500px){
  :root{ --stage-min:980px; --stage-ideal:92vw; --icon-scale:.74 }
}
@media (max-width:900px){
  :root{ --reel-gap:14px; --icon-scale:.72 }
  .hud-card{ transform:scale(.96); transform-origin:bottom left }
  .hud-floating.hud-top-right .hud-card{ transform-origin:top right }
}
@media (max-width:540px){
  :root{ --reel-gap:12px; --icon-scale:.70 }
  .btn.big{ font-size:16px; padding:10px 14px }
}
/* ===== HUD compact : 1 colonne + moitié de largeur + style intégré ===== */
.hud-card.hud-compact{
  position: relative;
  /* largeur compacte (≈ 2× moins large que 220–320px) */
  width: clamp(140px, 22vmin, 180px);
  min-width: unset;
  max-width: unset;
  padding: 10px 12px 12px;
  border-radius: 12px;
  overflow: hidden; /* pour les effets décoratifs */
  backdrop-filter:blur(var(--hud-blur)) saturate(120%); 
  -webkit-backdrop-filter:blur(var(--hud-blur)) saturate(120%);
}

/* Reflet intérieur du HUD compact (remplace le liseré dégradé) */
.hud-card.hud-compact::before{
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: calc(12px - 1px);
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0) 45%);
  pointer-events: none;
  mix-blend-mode: soft-light;
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  z-index: 0;
}

/* Grille du HUD en 1 seule colonne */
.hud-card.hud-compact .hud-grid{
  grid-template-columns: 1fr;          /* au lieu de 1fr auto */
  align-items: start;
  gap: 4px 0;
  position: relative; z-index: 1;
}

/* Labels compacts */
.hud-card.hud-compact .hud-label{
  font-size: 11px;
  letter-spacing: .04em;
  text-transform: uppercase;
  color: var(--hud-label);
  opacity: .9;
  margin-top: 6px;
}
.hud-card.hud-compact .hud-label:first-child{ margin-top: 0 }

/* Valeurs bien lisibles (tabular-nums pour l’alignement des chiffres) */
.hud-card.hud-compact .hud-value{
  font-size: 22px;
  font-weight: 800;
  color: var(--hud-text);
  line-height: 1.1;
  font-variant-numeric: tabular-nums;
  margin-bottom: 6px;
}

/* Contrôles de mise compacts sur une seule ligne */
.hud-card.hud-compact .bet-controls{
  display: grid;
  grid-template-columns: auto 1fr auto; /* − [valeur] + */
  gap: 6px;
  align-items: center;
  position: relative; z-index: 1;
}
.hud-card.hud-compact .bet-controls .hud-value{
  margin: 0;
  text-align: center;
}
.hud-card.hud-compact .btn.hud{
  padding: 4px 10px;
  font-size: 14px;
}

/* Animation de tremblement global de la machine au démarrage */
.machine.shake {
  animation: machineShake 0.6s ease-out;
}

@keyframes machineShake {
  0%, 100% { transform: translateX(0); }
  10% { transform: translateX(-1px) translateY(0.5px); }
  20% { transform: translateX(1px) translateY(-0.5px); }
  30% { transform: translateX(-0.5px) translateY(0.5px); }
  40% { transform: translateX(0.5px) translateY(-0.3px); }
  50% { transform: translateX(-0.3px) translateY(0.3px); }
  60% { transform: translateX(0.3px) translateY(-0.2px); }
  70% { transform: translateX(-0.2px) translateY(0.2px); }
  80% { transform: translateX(0.1px) translateY(-0.1px); }
  90% { transform: translateX(-0.1px) translateY(0.1px); }
}

/* ==================== ANIMATIONS DE DÉFAITE AMÉLIORÉES ==================== */

/* Overlay pour le message de défaite */
.lose-message-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--lose-overlay-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
}

.lose-message-overlay.show {
  opacity: 1;
  visibility: visible;
}

/* Boîte du message de défaite */
.lose-message {
  background: var(--lose-message-bg);
  border: none; /* retirer la bordure */
  border-radius: 20px;
  padding: 40px;
  text-align: center;
  max-width: 500px;
  backdrop-filter: blur(10px);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  transform: scale(0.8) translateY(20px);
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.lose-message-overlay.show .lose-message {
  transform: scale(1) translateY(0);
}

/* Icône de défaite */
.lose-icon {
  font-size: 60px;
  margin-bottom: 20px;
  animation: lose-shake 0.6s ease-in-out;
}

/* Texte principal du message */
.lose-text {
  font-size: 24px;
  font-weight: 700;
  color: var(--lose-text-color);
  margin-bottom: 15px;
  text-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
}

/* Texte d'indication */
.lose-hint {
  font-size: 16px;
  color: var(--lose-hint-color);
  font-weight: 400;
  opacity: 0.8;
}

/* Animation de secousse pour l'icône */
@keyframes lose-shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
  20%, 40%, 60%, 80% { transform: translateX(3px); }
}

/* Animation d'encouragement pour le bouton de spin */
.btn.pulse-encourage {
  animation: pulse-encourage 2s infinite;
  position: relative;
}

.btn.pulse-encourage::after {
  content: '';
  position: absolute;
  top: -4px;
  left: -4px;
  right: -4px;
  bottom: -4px;
  background: linear-gradient(45deg, #ff6b6b, #ffd93d, #6bcf7f, #4d9de0);
  border-radius: inherit;
  z-index: -1;
  animation: pulse-encourage-glow 2s infinite;
}

@keyframes pulse-encourage {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 10px rgba(255, 107, 107, 0);
  }
}

@keyframes pulse-encourage-glow {
  0%, 100% {
    opacity: 0.6;
    transform: scale(0.95);
  }
  50% {
    opacity: 1;
    transform: scale(1.1);
  }
}

/* Animation améliorée pour les symboles perdants */
.symbol.lose-fade {
  animation: lose-fade-enhanced 2s ease-in-out;
}

@keyframes lose-fade-enhanced {
  0% {
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }
  25% {
    opacity: 0.7;
    transform: scale(0.95) rotate(-2deg);
  }
  50% {
    opacity: 0.4;
    transform: scale(0.9) rotate(2deg);
  }
  75% {
    opacity: 0.2;
    transform: scale(0.85) rotate(-1deg);
  }
  100% {
    opacity: 0.1;
    transform: scale(0.8) rotate(0deg);
    filter: grayscale(100%) blur(2px);
  }
}

/* Effet de secousse renforcé pour la machine lors d'une défaite */
.machine.defeat {
  animation: machine-defeat-shake 0.8s ease-in-out;
}

@keyframes machine-defeat-shake {
  0%, 100% { transform: translateX(0) translateY(0); }
  10% { transform: translateX(-2px) translateY(-1px); }
  20% { transform: translateX(2px) translateY(1px); }
  30% { transform: translateX(-3px) translateY(-2px); }
  40% { transform: translateX(3px) translateY(2px); }
  50% { transform: translateX(-2px) translateY(-1px); }
  60% { transform: translateX(2px) translateY(1px); }
  70% { transform: translateX(-1px) translateY(-1px); }
  80% { transform: translateX(1px) translateY(1px); }
  90% { transform: translateX(-1px) translateY(0); }
}

/* -------- Indicateurs de ligne de gains (temporairement désactivés) -------- */
.reel::after {
  display: none; /* Désactivé temporairement pour debug */
  content: '';
  position: absolute;
  left: -2px;
  right: -2px;
  top: calc(var(--symbol-size));
  height: calc(var(--symbol-size));
  border: 2px solid rgba(124, 154, 255, 0.15);
  border-radius: 8px;
  pointer-events: none;
  z-index: 1;
  transition: border-color 0.3s ease;
}

/* Ligne de gains plus visible lors des victoires */
.reel.win-line::after {
  border-color: rgba(48, 230, 143, 0.4);
  box-shadow: 
    0 0 8px rgba(48, 230, 143, 0.2),
    inset 0 0 8px rgba(48, 230, 143, 0.1);
}

/* Symboles de la ligne de gains (ligne centrale) */
.symbol.payline-symbol {
  position: relative;
}

.symbol.payline-symbol::before {
  content: '';
  position: absolute;
  left: -1px;
  right: -1px;
  top: -1px;
  bottom: -1px;
  border: 1px solid rgba(124, 154, 255, 0.1);
  border-radius: 6px;
  pointer-events: none;
  z-index: -1;
}

/* Debug temporaire retiré pour un affichage propre */

/* Numéros de debug retirés */

/* RFID waiting overlay */
.rfid-overlay {
  position: fixed;
  inset: 0;
  background: radial-gradient(1200px 800px at 50% 40%, rgba(10, 14, 28, 0.95) 0%, rgba(4, 6, 12, 0.98) 60%);
  display: grid;
  place-items: center;
  z-index: 10000;
  opacity: 0;
  visibility: hidden;
  transition: opacity .35s ease, visibility .35s ease;
}
.rfid-overlay.show { opacity: 1; visibility: visible; }

.rfid-scene {
  position: relative;
  display: grid;
  place-items: center;
  gap: 24px;
  text-align: center;
  color: #e7f0ff;
}

.rfid-card {
  width: clamp(180px, 26vmin, 320px);
  aspect-ratio: 1.586; /* credit card ratio */
  border-radius: 18px;
  background: linear-gradient(135deg, rgba(124,154,255,.18), rgba(0,245,212,.14));
  border: 1px solid rgba(255,255,255,.15);
  box-shadow: 0 30px 80px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);
  position: relative;
  overflow: hidden;
  animation: cardFloat 3s ease-in-out infinite;
}
.rfid-card::before{
  content:""; position:absolute; inset:0; pointer-events:none;
  background: radial-gradient(120% 100% at 0% 0%, rgba(255,255,255,.10), rgba(255,255,255,0) 40%),
              radial-gradient(120% 100% at 100% 100%, rgba(255,255,255,.06), rgba(255,255,255,0) 40%);
  mix-blend-mode: soft-light;
}
.rfid-chip{
  position: absolute; top: 16%; left: 10%; width: 18%; aspect-ratio: 1/0.8;
  border-radius: 6px; background: linear-gradient(180deg,#ffd93d,#b37d00);
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.15);
}
.rfid-logo{
  position: absolute; right: 10%; bottom: 12%; font-weight: 900; letter-spacing: .08em;
  font-size: clamp(18px, 3.5vmin, 26px); color: #fff;
  text-shadow: 0 6px 18px rgba(124,154,255,.5);
}
@keyframes cardFloat {
  0%,100% { transform: translateY(0) rotate(-2deg); }
  50% { transform: translateY(-8px) rotate(-1deg); }
}

.rfid-waves { position: relative; width: clamp(200px, 35vmin, 420px); height: 18px; }
.rfid-waves span{
  position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
  width: 40%; height: 6px; border-radius: 999px;
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(124,154,255,.8), rgba(0,0,0,0));
  filter: blur(0.5px);
  animation: wave 1.6s ease-in-out infinite;
}
.rfid-waves span:nth-child(2){ width: 60%; animation-delay: .2s; opacity: .7; }
.rfid-waves span:nth-child(3){ width: 80%; animation-delay: .4s; opacity: .5; }
.rfid-waves span:nth-child(4){ width: 100%; animation-delay: .6s; opacity: .35; }
@keyframes wave { 0%,100%{ transform: translate(-50%,-50%) scaleX(0.98); } 50%{ transform: translate(-50%,-50%) scaleX(1.02);} }

.rfid-text h1{ margin:0 0 6px; font-size: clamp(22px, 3.2vmin, 34px); letter-spacing:.02em }
.rfid-text p{ margin:0; opacity:.9 }
.rfid-text .hint{ color:#cfe6ff; opacity:.7; font-size:.95em }

/* Hide app while waiting */
body.rfid-wait .app, body.rfid-wait .hud-floating, body.rfid-wait #devPanel{ filter: blur(3px); pointer-events:none; user-select:none; }
